%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%   LaTeX source code for a work instruction
% 	Developed by: J. Mount, j.mount@qut.edu.au
%   Updated by:
%	Last updated: 11-October-2022
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% PRE-AMBLE %%%
\documentclass[11pt, a4paper, titlepage]{article}
\usepackage[a4paper, total={7in, 8in}]{geometry}    % sets margins

\usepackage{graphicx}   % need for figures
\usepackage{fancyhdr}   % used for custom header
\usepackage{lipsum}
\usepackage[table]{xcolor}
\usepackage{lastpage}
\usepackage{float}
\usepackage{enumitem}
\usepackage{amssymb}
\usepackage{etoolbox}
\usepackage{pifont}
\usepackage{booktabs}
\usepackage{stackengine}
\usepackage{ifthen}
\usepackage{intcalc}
\usepackage{tikz}
\usepackage{xparse}
\usepackage[section]{placeins}

%%% INPUT PRE-AMBLE FILES %%%
\input{setup.tex}
\input{ppe.tex}
\input{hazards.tex}


%%%%%%%%%%%%%%%%%%%%%
%%% CONFIGURATION %%% - change stuff here
%%%%%%%%%%%%%%%%%%%%%

% Enter the title for the work instruction
\Title{Work Instruction Title}

% Enter Faculty/Divsision
\Faculty{Research Infrastructure - Research Engineering Facility}

% Enter Work Instruction Purpose
\Purpose{Purpose of WI is...}

% Specify the Risk Assessment Number
\RiskAssessmentNumber{XXX}

% List the applicable documents
\SetApplicableDocuments{
    \item Competency to Operate Required - Filename TBD
}

% Specify if training required before operation
\TrainingRequired{true}

% Specify the hazards/risks and set text
% Each command can take two optional arguments to alter the bolded text and provide optional text
% \AcidHazards[Change Bold Text][Optional Text]{true}
\AcidHazards{true}
\BiohazardHazards{true}
\ElectrocutionHazards{true}
\ExplosiveHazards{true}
\FlammableHazards{true}
\HighTemperatureHazards{true}
\HotSurfaceHazards{true}
\LowTemperatureHazards{true}
\MagneticFieldHazards{true}
\LoudNoiseHazards{true}
\PinchPointHazards{true}
\RadiationHazards{true}
\RadioWaveHazards{true}
\SlipHazards{true}
\ToxicHazards{true}
\TripHazards{true}

% Specify the required ppe and set text
% Each command can take two optional arguments to alter the bolded text and provide optional text
% \AdjustableGuardRequired[Change Bold Text][Optional Text]{true}
\AdjustableGuardRequired{true}
\ApronRequired{true}
\BreathingApparatusRequired{true}
\CoatRequired{true}
\DustMaskRequired{true}
\EyeProtectionRequired{true}
\FaceShieldRequired{true}
\FootwearRequired{true}
\GlovesRequired{true}
\HalfFaceMaskRequired{true}
\HardHatRequired{true}
\HearingProtectionRequired{true}
\HighVisRequired{true}
\RespiratorRequired{true}
\SafetyHarnessRequired{true}
\StaticGuardRequired{true}
\HandWashingRequired{true}
\WeldingMaskRequired{true}


% Specify the emergency procedure
\SetEmergencyProcedure{
    Add your emergency procedure here. You can create lists
    \begin{itemize}[noitemsep]
        \item Point 1
        \item Point 2
    \end{itemize}
    \lipsum[4]
}

% Set Process
\SetPreWorkProcess{
    You can include figures
    \makeatletter
    \begin{figure}[h]
        \centering
        \includegraphics[width=50mm]{images/ppe/adjustable_guard.jpg}
        \caption{Look a figure}
    \end{figure}
    \\
    And lists
    \begin{enumerate}[noitemsep]
        \item Step 1
        \item Step 2
    \end{enumerate}
    
    \lipsum[1]
}

\SetWorkProcess{
    \lipsum[2]
}

\SetPostWorkProcess{
    \lipsum[3]
}

% Specify the author, their role, and the date the document was created
\Author{XXX}
\AuthorRole{XXX}
\DateCreated{XXX}

% Specify the verifier, their role, and the date the document was verified
\Verifier{XXX}
\VerifierRole{XXX}
\DateVerified{XXX}

% Specify the approver, their role, and the date the document was approved
\Approver{XXX}
\ApproverRole{XXX}
\DateApproved{XXX}

% Specify the date the WI is to be reviewed (should be at least every 5 years)
\ReviewDate{XXX}

% Specify the document version, should only be changed when content changes not format
\Version{v1.0}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%% YOU SHOULDN'T NEED TO TOUCH ANYTHING BELOW HERE %%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%% PLACE INS FLOAT BARRIER %%%

\makeatletter
\AtBeginDocument{%
  \expandafter\renewcommand\expandafter\subsection\expandafter{%
    \expandafter\@fb@secFB\subsection
  }%
}
\makeatother

%%% DOCUMENT %%%
\begin{document}

    %%% TITLE %%%
    \noindent
    \huge{\textbf{Work Instruction}} \\
    \huge{\textbf{\Title}}
    \vspace{-5mm}

    %%% OVERVIEW TABLE %%%
    \section{Overview}
    \normalsize
    \vspace{-5mm}
    This work instruction should be read in conjunction with information on the HSE resources page on QUT's Digital Workplace. If you do not have access to this information, speak to your supervisor. \textbf{Please note}, This work instruction does not replace a risk assessment. A risk asssessment should be completed prior to creating this work instruction to identify hazards, risks, and appropriate controls.
    \begin{table}[H]
        \centering
        \begin{tabular}{|p{0.2\textwidth}|p{0.75\textwidth}|}
            \hline
            \cellcolor{black!25}\textbf{Faculty/Division} & \Faculty \\ \hline
            \cellcolor{black!25}\textbf{Purpose} & \Purpose \\ \hline
            \cellcolor{black!25}\textbf{Training Required} & \iftoggle{trainingrequired}{CTO Certificate is \textbf{required} before use}{Training is not required prior to use} \\ \hline
            \rowcolor{black!25}\multicolumn{2}{|p{0.975\textwidth}|}{\textbf{Applicable Documents}} \\ \hline
            \multicolumn{2}{|p{0.95\textwidth}|}{
            \vspace{-3mm}
            \begin{itemize}[noitemsep]
                \item Risk Assessment No: \RiskAssessmentNumber
                \ApplicableDocuments
            \end{itemize}
            } \\ \hline
        \end{tabular}
    \end{table}

    %%% HAZARDS / RISKS %%%
    \section{Hazards and PPE}
    \HazardsPresentTable

    %%% PPE REQUIRED %%%
    \PPERequiredTable

    %%% EMERGENCY PROCEDURE %%%
    \newpage
    \section{Emergency Procedure}
    \begin{table}[H]
        \centering
        \begin{tabular}{|p{0.975\textwidth}|}
            \hline
            \cellcolor{red!65}\textbf{Emergency Procedure} \\ \hline
            \textbf{QUT Security Emergency Ph. 3138 888} \\
            \textbf{Fire, Police, Ambulance Ph. 000 or 112 from a mobile} \\ \hline
            \EmergencyProcedure \\ \hline
        \end{tabular}
    \end{table}

    %%% PROCESS %%%
    \newpage
    \section{Process}

    \subsection{Pre-Work}
    \PreWorkProcess

    \subsection{Work}
    \WorkProcess

    \subsection{Post-Work}
    \PostWorkProcess


    %%% DOCUMENT APPROVAL TABLE %%%
    \section{Document Approval}
    Once approved, this Work Instruction should be kept in accordance with your local area's record keeping procedures. A hard copy should be kept near areas where the work is being done. The document should be amended as required and reviewed every 5 years.

    \begin{table}[H]
        \centering
        \begin{tabular}{|p{0.225\textwidth}|p{0.225\textwidth}|p{0.225\textwidth}|p{0.225\textwidth}|}
            \hline

            \rowcolor{black!25} & \textbf{Name} & \textbf{Role} & \textbf{Date} \\ \hline
            \cellcolor{black!25}\textbf{Author} & \Author & \AuthorRole & Created: \DateCreated \\ \hline
            \cellcolor{black!25}\textbf{Verifier} & \Verifier & \VerifierRole & Verified: \DateVerified \\ \hline
            \cellcolor{black!25}\textbf{Approver} & \Approver & \ApproverRole & Approved: \DateApproved \\ \hline

            \cellcolor{black!25}\textbf{Date for Review} & \multicolumn{3}{|p{0.724\textwidth}|}{\ReviewDate} \\ \hline
        \end{tabular}
    \end{table}

    
\end{document}